{% import "macros/format_date.html" as macros_format_date %}
{% import "macros/list_posts.html" as macros_list_posts %}
{% import "macros/page_header.html" as macros_page_header %}
{% import "macros/rel_attributes.html" as macros_rel_attributes %}
{% import "macros/settings.html" as macros_settings %}
{% import "macros/table_of_contents.html" as macros_toc %}
{% import "macros/translate.html" as macros_translate %}

{# Load the internationalisation data for the current language from
the .toml files in the user's '/i18n' folder, falling back to the theme's.
This variable will hold all the text strings for the language #}
{%- set language_strings = load_data(path="i18n/" ~ lang ~ '.toml', required=false) -%}
{%- if not language_strings -%}
    {%- set language_strings = load_data(path="themes/tabi/i18n/" ~ lang ~ ".toml", required=false) -%}
{%- endif -%}
{% set rtl_languages = ["ar", "arc", "az", "dv", "ff", "he", "ku", "nqo", "fa", "rhg", "syc", "ur"] %}


<!DOCTYPE html>
<html lang="{{ lang }}" {% if config.extra.default_theme -%}
    data-theme="{{config.extra.default_theme}}"
{%- endif -%}>

{% include "partials/header.html" %}

<body{% if lang in rtl_languages %} dir="rtl"{% endif %}{% if config.extra.override_serif_with_sans %} class="use-sans-serif"{% endif %}>
    {% include "partials/nav.html" %}
    <div class="content">

        {# Post page is the default #}
        {% block main_content %}
            Nothing here?!
        {% endblock main_content %}
    </div>
    {% include "partials/footer.html" %}

    {% if config.extra.katex %}
        <script defer src="{{ get_url(path='js/katex.min.js') }}"></script>
        <script defer src="{{ get_url(path='js/auto-render.min.js') }}"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            });
        </script>
    {% endif %}

    {# Reading Progress Bar JavaScript #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const progressBar = document.getElementById('reading-progress');
            if (!progressBar) return;

            function updateReadingProgress() {
                const article = document.querySelector('article');
                if (!article) return;

                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const articleTop = article.offsetTop;
                
                // Calculate how much of the article has been scrolled through
                const scrollPosition = scrollTop - articleTop;
                const maxScroll = articleHeight - windowHeight;
                
                if (maxScroll <= 0) {
                    progressBar.style.width = '100%';
                } else {
                    const progress = Math.min(100, Math.max(0, (scrollPosition / maxScroll) * 100));
                    progressBar.style.width = progress + '%';
                }
            }

            // Update progress on scroll
            window.addEventListener('scroll', updateReadingProgress);
            
            // Initial calculation
            updateReadingProgress();
        });
    </script>
</body>

</html>
